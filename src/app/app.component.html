<h1>AMP KiwiSaver helper</h1>

<p>This tool calculates how much you will need to add to your KiwiSaver to make the most of the government
  contribution based on a report generated by AMP's website. </p>

<div class="button-bar">
  <input #csvInput hidden type="file" onclick="this.value=null" (change)="uploadCsv($event)"
         accept=".csv"/>
  <button mat-raised-button color="primary" (click)="csvInput.click()">
    <mat-icon aria-hidden="true">file_upload</mat-icon>
    Upload CSV file
  </button>

  <button mat-raised-button color="primary" (click)="downloadCsv()" [disabled]="records == null || recordsIsEmpty">
    <mat-icon aria-hidden="true">file_download</mat-icon>
    Download CSV file
  </button>

  <button mat-icon-button color="accent" aria-label="Help" (click)="openHelp()">
    <mat-icon>help</mat-icon>
  </button>
</div>

<p *ngIf="recordsIsEmpty">
  No transactions to display. Try exporting a longer date range from AMP (select the help button for more information).
</p>

<div *ngIf="records">
  <ng-container *ngFor="let year of years">
    <h2>{{year}}</h2>

    <div class="button-bar">
      <mat-chip-list *ngIf="records != null">
        <mat-chip>Direct debits: ${{directDebitTotals[year] | number : '1.2-2'}}</mat-chip>
        <mat-chip>Member contributions: ${{memberContributionsTotals[year] | number : '1.2-2'}}</mat-chip>
        <mat-chip>Total: ${{getTotal(year) | number : '1.2-2'}}</mat-chip>
        <mat-chip *ngIf="!getTotalIsEnough(year)">⚠️ Left to get: ${{getLeftToGet(year) | number : '1.2-2'}}</mat-chip>
        <mat-chip *ngIf="getTotalIsEnough(year)">✅ You've contributed enough!</mat-chip>
        <mat-chip *ngIf="govtContributions[year]">
          <ng-container *ngIf="govtContributions[year] > 521.43">🤑</ng-container>
          <ng-container *ngIf="govtContributions[year] == 521.43">😊</ng-container>
          <ng-container *ngIf="govtContributions[year] < 521.43 && govtContributions[year] >= 1">🙂</ng-container>
          <ng-container *ngIf="govtContributions[year] < 1">🙁</ng-container>
          Government contributed: ${{govtContributions[year]}}
        </mat-chip>
      </mat-chip-list>
    </div>

    <table mat-table [dataSource]="records[year]" class="mat-elevation-z8" *ngIf="records != null">
      <mat-text-column name="EffectiveDate"></mat-text-column>
      <mat-text-column name="Description"></mat-text-column>
      <mat-text-column name="Option"></mat-text-column>
      <mat-text-column name="Account"></mat-text-column>
      <mat-text-column name="Units"></mat-text-column>
      <mat-text-column name="UnitPrice"></mat-text-column>
      <mat-text-column name="Amount"></mat-text-column>

      <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
      <tr mat-row *matRowDef="let row; columns:columnsToDisplay;"></tr>
    </table>

  </ng-container>
</div>

<mat-spinner *ngIf="loadingDataFromCsv && !records"></mat-spinner>
